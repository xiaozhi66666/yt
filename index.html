<!DOCTYPE html>
<html>

<head>
    <title>圆通异常记录</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0,user-scalable=no">
    <style>
        #messageBox {
            white-space: pre-line;
            overflow-y: scroll;
            max-height: 200px;
            width: 100%;
        }

        @media screen and (max-width:640px) {
            #messageBox {
                max-height: 500px;
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <button id="button1">过光幕异常停机</button>
    <button id="button2">撞机</button>
    <button id="button3">人工干预包裹</button>
    <div id="messageBox"></div>
    <button id="saveButton">保存记录</button>
    <button id="clearButton">清除记录</button>

    <script>
        const maxRows = 25;
        const maxColumns = 4; // Number of columns to display

        const messages = Array.from({ length: maxColumns }, () => []);
        let recordCount = 1;
        let currentColumn = 0;

        const button1 = document.getElementById("button1");
        const button2 = document.getElementById("button2");
        const button3 = document.getElementById("button3");
        const messageBox = document.getElementById("messageBox");
        const saveButton = document.getElementById("saveButton");
        const clearButton = document.getElementById("clearButton");

        button1.addEventListener("click", () => logButton("过光幕异常停机"));
        button2.addEventListener("click", () => logButton("撞机"));
        button3.addEventListener("click", () => logButton("人工干预包裹"));
        saveButton.addEventListener("click", saveRecords);
        clearButton.addEventListener("click", clearMessages);

        function logButton(buttonName) {
            const timestamp = new Date().toLocaleString();
            const message = `${recordCount}, ${buttonName}, ${timestamp}`;
            messages[currentColumn].push(message);

            if (messages[currentColumn].length > maxRows) {
                messages[currentColumn].shift(); // Remove the oldest message when exceeding the limit
            }

            updateMessageBox();
            recordCount++;
            currentColumn = (currentColumn + 1) % maxColumns; // Cycle through columns
        }

        function updateMessageBox() {
            messageBox.textContent = messages.map(columnMessages => columnMessages.join("\n")).join("\n\n");
        }

        function saveRecords() {
            let csvContent = "序号, 异常形式, 时间\n";
            for (const columnMessages of messages) {
                columnMessages.forEach((message) => {
                    csvContent += message + "\n";
                });
            }

            const blob = new Blob([csvContent], { type: "text/csv" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "records.csv";
            a.click();
        }

        function clearMessages() {
            for (const columnMessages of messages) {
                columnMessages.length = 0;
            }
            updateMessageBox();
            recordCount = 1;
            currentColumn = 0;
        }
    </script>
</body>

</html>